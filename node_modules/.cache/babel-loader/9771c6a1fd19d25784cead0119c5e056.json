{"ast":null,"code":"import _slicedToArray from \"/Users/a.seki/Documents/twitter_post/tweet-ref/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/a.seki/Documents/twitter_post/tweet-ref/src/App.js\";\nimport React from 'react';\nimport './App.css';\nimport { useState, useEffect } from 'react';\n\nfunction App() {\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        flag = _useState2[0],\n        setFlag = _useState2[1];\n\n  const _useState3 = useState(''),\n        _useState4 = _slicedToArray(_useState3, 2),\n        userData = _useState4[0],\n        setUserData = _useState4[1];\n\n  const _useState5 = useState(''),\n        _useState6 = _slicedToArray(_useState5, 2),\n        data = _useState6[0],\n        setData = _useState6[1]; //webSocketとの通信\n\n\n  const ws = new WebSocket('ws://localhost:5000/pipe'); // レンダー前にwsがopenした後にurl内のverifierを返す\n\n  useEffect(() => {\n    ws.onopen = event => {\n      console.log('useEffect');\n\n      if (window.location.search.includes('verifier')) {\n        setFlag(true);\n        console.log(typeof getParam('oauth_token'));\n        const envelope = {\n          oauth_token: getParam('oauth_token'),\n          oauth_verifier: getParam('oauth_verifier')\n        }; //サーバへ送信\n\n        ws.send(JSON.stringify(envelope));\n      }\n    };\n\n    setUserData('true');\n  }); //url無いの特定の要素を持ってくるためのコード(コピペ)\n\n  function getParam(name, url) {\n    if (!url) url = window.location.href;\n    name = name.replace(/[\\[\\]]/g, '\\\\$&');\n    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n        results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n  } // サーバー側からメッセージが送られてきた際に受け取り、関数を発動する(Twitterの認証用URLに飛ぶため)\n\n\n  ws.onmessage = e => {\n    console.log(e);\n\n    if (e.data.includes('oauth_token')) {\n      window.location.href = e.data;\n    } else {\n      console.log(e);\n      setData(e.data);\n    }\n  }; //クリックした時(今回は文字をbuttonをクリックしたらサーバーにTwitterのもじが送られる)\n\n\n  function handleClick() {\n    console.log('rest');\n    ws.send('Twitter');\n  }\n\n  console.log(flag); //レンダー要素の切替\n\n  let render = flag ? React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }, data) : React.createElement(\"button\", {\n    onClick: handleClick,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61\n    },\n    __self: this\n  }, \"\\u9023\\u643A\\u30A2\\u30D7\\u30EA\\u8A8D\\u8A3C\");\n  return React.createElement(React.Fragment, null, render);\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/a.seki/Documents/twitter_post/tweet-ref/src/App.js"],"names":["React","useState","useEffect","App","flag","setFlag","userData","setUserData","data","setData","ws","WebSocket","onopen","event","console","log","window","location","search","includes","getParam","envelope","oauth_token","oauth_verifier","send","JSON","stringify","name","url","href","replace","regex","RegExp","results","exec","decodeURIComponent","onmessage","e","handleClick","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport './App.css';\nimport { useState, useEffect } from 'react';\n\nfunction App() {\n  const [flag, setFlag] = useState(false);\n  const [userData, setUserData] = useState('');\n  const [data, setData] = useState('');\n  //webSocketとの通信\n  const ws = new WebSocket('ws://localhost:5000/pipe');\n  // レンダー前にwsがopenした後にurl内のverifierを返す\n  useEffect(() => {\n    ws.onopen = event => {\n      console.log('useEffect');\n      if (window.location.search.includes('verifier')) {\n        setFlag(true);\n        console.log(typeof getParam('oauth_token'));\n        const envelope = {\n          oauth_token: getParam('oauth_token'),\n          oauth_verifier: getParam('oauth_verifier')\n        };\n        //サーバへ送信\n        ws.send(JSON.stringify(envelope));\n      }\n    };\n    setUserData('true');\n  });\n\n  //url無いの特定の要素を持ってくるためのコード(コピペ)\n  function getParam(name, url) {\n    if (!url) url = window.location.href;\n    name = name.replace(/[\\[\\]]/g, '\\\\$&');\n    var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),\n      results = regex.exec(url);\n    if (!results) return null;\n    if (!results[2]) return '';\n    return decodeURIComponent(results[2].replace(/\\+/g, ' '));\n  }\n\n  // サーバー側からメッセージが送られてきた際に受け取り、関数を発動する(Twitterの認証用URLに飛ぶため)\n  ws.onmessage = e => {\n    console.log(e);\n    if (e.data.includes('oauth_token')) {\n      window.location.href = e.data;\n    } else {\n      console.log(e);\n      setData(e.data);\n    }\n  };\n  //クリックした時(今回は文字をbuttonをクリックしたらサーバーにTwitterのもじが送られる)\n  function handleClick() {\n    console.log('rest');\n    ws.send('Twitter');\n  }\n  console.log(flag);\n\n  //レンダー要素の切替\n  let render = flag ? (\n    <div>{data}</div>\n  ) : (\n    <button onClick={handleClick}>連携アプリ認証</button>\n  );\n  return <>{render}</>;\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}